<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Design of Role-Based Access Control</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="1.1-front-page.html"><strong aria-hidden="true">1.</strong> Welcome</a></li><li class="chapter-item expanded "><a href="about.html"><strong aria-hidden="true">2.</strong> About LumoSQL</a></li><li class="chapter-item expanded "><a href="1.2-top-features.html"><strong aria-hidden="true">3.</strong> Top Features</a></li><li class="chapter-item expanded "><a href="1.4-install-LumoSQL.html"><strong aria-hidden="true">4.</strong> Install</a></li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">5.</strong> Quick Build and Benchmark</a></li><li class="chapter-item expanded affix "><li class="part-title">Features</li><li class="chapter-item expanded "><a href="3.4-not-forking-tool.html"><strong aria-hidden="true">6.</strong> Not-Forking Tool</a></li><li class="chapter-item expanded "><a href="lumo-build-benchmark.html"><strong aria-hidden="true">7.</strong> Build and Benchmark System (build.tcl)</a></li><li class="chapter-item expanded "><a href="backends.html"><strong aria-hidden="true">8.</strong> Available Backends - SQLite B-tree and LMDB</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lumo-sqlite-bdb-backend.html"><strong aria-hidden="true">8.1.</strong> BDB 18.1.32 Backend</a></li><li class="chapter-item expanded "><a href="lumo-malbrain-backend.html"><strong aria-hidden="true">8.2.</strong> Karl Malbrain's C Btree</a></li></ol></li><li class="chapter-item expanded "><a href="lumo-corruption-detection-and-magic.html"><strong aria-hidden="true">9.</strong> Corruption Detection</a></li><li class="chapter-item expanded "><a href="3.3-benchmarking.html"><strong aria-hidden="true">10.</strong> Benchmarking</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lumo-benchmark-filter.html"><strong aria-hidden="true">10.1.</strong> Displaying Benchmark Results (benchmark-filter.tcl)</a></li><li class="chapter-item expanded "><a href="statistical_analysis.html"><strong aria-hidden="true">10.2.</strong> Statistical Analysis</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">New features</li><li class="chapter-item expanded "><a href="rbac-design.html" class="active"><strong aria-hidden="true">11.</strong> Design of Role-Based Access Control</a></li><li class="chapter-item expanded "><a href="encryption.html"><strong aria-hidden="true">12.</strong> Encryption</a></li><li class="chapter-item expanded "><a href="lumion_intro.html"><strong aria-hidden="true">13.</strong> Lumion</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rfc.html"><strong aria-hidden="true">13.1.</strong> Lumion RFC</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Research</li><li class="chapter-item expanded "><a href="2.1-development-landscape.html"><strong aria-hidden="true">14.</strong> SQLite Development Landscape</a></li><li class="chapter-item expanded "><a href="3.7-relevant-codebases.html"><strong aria-hidden="true">15.</strong> Overview of Relevant Codebases</a></li><li class="chapter-item expanded "><a href="2.4-relevant-knowledgebase.html"><strong aria-hidden="true">16.</strong> Overview of the Relevant Knowledgebase</a></li><li class="chapter-item expanded "><a href="3.6-development-notes.html"><strong aria-hidden="true">17.</strong> LumoSQL 2019 Prototype</a></li><li class="chapter-item expanded affix "><li class="part-title">Design</li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">18.</strong> SQLite API Interception Points</a></li><li class="chapter-item expanded "><a href="virtual-machine.html"><strong aria-hidden="true">19.</strong> SQLite Virtual Machine Layer</a></li><li class="chapter-item expanded "><a href="WALs.html"><strong aria-hidden="true">20.</strong> LMDB Alternative to WALs</a></li><li class="chapter-item expanded "><a href="what-are-savepoints.html"><strong aria-hidden="true">21.</strong> Savepoints in SQLite</a></li><li class="chapter-item expanded "><a href="online-database-servers.html"><strong aria-hidden="true">22.</strong> Online Database Servers</a></li><li class="chapter-item expanded affix "><li class="part-title">Other</li><li class="chapter-item expanded "><a href="LumoSQL-PhaseII-Announce.html"><strong aria-hidden="true">23.</strong> News - Phase II Announcement</a></li><li class="chapter-item expanded "><a href="release-announce-0.4.html"><strong aria-hidden="true">24.</strong> News - Release 0.4 Announcement</a></li><li class="chapter-item expanded "><a href="release-announce-0.3.html"><strong aria-hidden="true">25.</strong> News - Release 0.3 Announcement</a></li><li class="chapter-item expanded "><a href="lumo-gsoc-ideas.html"><strong aria-hidden="true">26.</strong> Google Summer of Code 2021</a></li><li class="chapter-item expanded "><a href="lumo-proposed-debug.html"><strong aria-hidden="true">27.</strong> SQLite Debug Proposal</a></li><li class="chapter-item expanded "><a href="CONTRIBUTING.html"><strong aria-hidden="true">28.</strong> Conributing</a></li><li class="chapter-item expanded "><a href="lumosql-meetbot.html"><strong aria-hidden="true">29.</strong> Contributing - IRC Meetbot</a></li><li class="chapter-item expanded "><a href="CODE-OF-CONDUCT.html"><strong aria-hidden="true">30.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="3.2-legal-aspects.html"><strong aria-hidden="true">31.</strong> Legal Aspects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="licensing.html"><strong aria-hidden="true">31.1.</strong> Licensing</a></li><li class="chapter-item expanded "><a href="MIT.html"><strong aria-hidden="true">31.2.</strong> MIT Licence</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Copyright 2021 The LumoSQL Authors, see LICENSES/MIT -->
<!-- SPDX-License-Identifier: MIT -->
<!-- SPDX-FileCopyrightText: 2020 The LumoSQL Authors -->
<!-- SPDX-ArtifactOfProjectName: LumoSQL -->
<!-- SPDX-FileType: Documentation -->
<!-- SPDX-FileComment: Original by Dan Shearer, August 2020 -->
<h1 id="lumosql-minimal-at-rest-discretionary-access-control-system"><a class="header" href="#lumosql-minimal-at-rest-discretionary-access-control-system">LumoSQL Minimal At-Rest Discretionary Access Control System</a></h1>
<p>Role
Authority
Privilege
Subjects
Objects</p>
<h1 id="how-it-compares"><a class="header" href="#how-it-compares">How it compares</a></h1>
<ul>
<li>RBAC is not centrally administered by default ...</li>
<li>A minimal subset of DAC implemented ...</li>
<li>Privileges default to all for every user, because an embedded ...</li>
</ul>
<p>Nobody else does at-rest fine-grained control</p>
<p>Not policies. Not columns. Not nested roles. Limited privileges, subjects and objects.</p>
<h1 id="definitions"><a class="header" href="#definitions">Definitions</a></h1>
<p>A  role is a database entity that is used to group a combination of authorities 
and/or privileges together so they can be simultaneously granted or revoked. 
When roles are used, the assignment of authorities and privileges is greatly 
simplified. For example, instead of granting the same set of authorities and 
privileges to every individual in a particular job function, you can assign a set 
of authorities and privileges to a role that represents the job and then grant 
membership in that role to every user who performs that particular job. It is 
important to note that only users with SECADM authority are allowed to 
create roles (by executing the CREATE ROLE SQL statement)</p>
<h1 id="the-lumosql-security-design-and-implementation"><a class="header" href="#the-lumosql-security-design-and-implementation">The LumoSQL Security Design and Implementation</a></h1>
<p>SQLite is an embedded database, and traditionally there has been no need of
access security in the main SQLite use case. The application took care of any
security needs, with a little-used password system for database access provided
by the C API. However once connected, there is little distinction between a
superuser or other users, and no encryption. Various solutions exist that
modify the SQLite source code to give one kind of encryption or another, as
documented in the 
<a href="https://lumosql.org/src/lumodoc/doc/tip/doc/lumo-relevant-knowledgebase.md#list-of-relevant-sql-checksumming-related-knowledge">LumoSQL Knowledgebase</a>.</p>
<p>The LumoSQL approach is completely different. LumoSQL recognises that the
security and privacy requirements of the 21st century are very different to the
primary use case of SQLite over more than two decades, and so implements a
fairly complete security system, recognisable to anyone who has used one of the
mainstream networked SQL databases.</p>
<p>On the other hand, SQLite's strength is its simplicity and the things that come
with that including speed, compact code and relative ease of security review.
An example of how security models can become so complex they are impossible to verify is provided by Microsoft SQL Server, whose 
<a href="https://raw.githubusercontent.com/Microsoft/sql-server-samples/master/samples/features/security/permissions-posters/Microsoft_SQL_Server_2017_and_Azure_SQL_Database_permissions_infographic.pdf">Chart of Database Access Permissions</a> defies analysis. 
Similar charts can be drawn up for Oracle, DB2 et al, with undoubted artistic merit. These databases need to solve very different problems to LumoSQL, and they must do it in a way that is compatible with decades-old security design. LumoSQL does not have these constraints.</p>
<h1 id="goals"><a class="header" href="#goals">Goals</a></h1>
<p>LumoSQL aims to deliver:</p>
<ul>
<li>At-rest data encryption at the database, table and row level</li>
<li>Per-row integrity controls (eg checksums) stored in each row</li>
<li>Per-row encryption, self-contained within each row</li>
<li>Per-row RBAC, self-contained within each row</li>
</ul>
<p>LumoSQL will avoid:</p>
<ul>
<li>Large amounts of security metadata</li>
<li>Mandating a key management system</li>
<li>Introducing new encryption technologies</li>
<li>A large or complex security model</li>
</ul>
<h1 id="design-principles"><a class="header" href="#design-principles">Design Principles</a></h1>
<ol start="0">
<li>LumoSQL data will be secure when at rest. This is consistent with the embedded use case, when databases are often at rest and often copied without knowledge of the application.</li>
<li>Security will be defined by the LumoSQL data, and travel with the data at all times.</li>
<li>Anyone with a valid key can read the data according to the LumoSQL security specification, using any conformant software.</li>
<li>Users may implement any (or no) key authority system. This is consistent with the way SQLite is used.</li>
<li>LumoSQL will define a standard key management system for anyone wanting to use it.</li>
<li>The fundamental unit for LumoSQL security is the encrypted row. Although database and tables can also be encrypted.</li>
</ol>
<h2 id="lumosql-is-a-hybrid-access-control-system"><a class="header" href="#lumosql-is-a-hybrid-access-control-system">LumoSQL is a Hybrid Access Control System</a></h2>
<p>All SQL database security models implement <a href="https://en.wikipedia.org/wiki/Discretionary_access_control">Discretionary Access Control</a>. The traditional embedded use case for SQLite is already well-suited to implementing <a href="https://en.wikipedia.org/wiki/Mandatory_access_control">Mandatory Access Control</a> on end users, because the application has ultimate control. LumoSQL will not implement Mandatory Access Control.</p>
<p>Within Discretionary Access Control there are different models and tradeoffs.
LumoSQL implements features from some of the most common approaches.</p>
<pre><code class="language-pikchr indent toggle source-inline">Frame: [
B: box invis 
line invis &quot;LumoSQL&quot; bold color purple from 0.5cm s of B.w to 0.5cm s of B.e
C1: circle color black rad 2cm at 0.8cm n of B.c
line invis &quot;Role-Based&quot; &quot;Access Control&quot; &quot;(RBAC)&quot; from 1cm n of C1.w to 1cm n of C1.e
C2: circle color black rad 2cm at 1.5cm sw of B.c
line invis &quot;Any or No&quot; &quot;Key Authority&quot; from 0.2cm s of C2.w to 0.2cm s of C2.c
C3: circle color black rad 2cm at 1.5cm se of B.c
line invis &quot;At-rest&quot; &quot;Encryption&quot; from C2.e to C3.e
Title: line invis &quot;Discretionary Access Control&quot; &quot;Systems&quot; color green from 4.2cm above C2.w to 4.2cm above C2.e
]
Border: box color gray rad 1cm thin width Frame.width+1cm height Frame.height+1cm at Frame.center
</code></pre>
<h1 id="lumosql-is-a-minimal-access-control-system"><a class="header" href="#lumosql-is-a-minimal-access-control-system">LumoSQL is a Minimal Access Control System</a></h1>
<p>LumoSQL implements the smallest possible security model that will satisfy the
goals. Nevertheless there are some features that are not implemented by any
other mainstream database. LumoSQL security aims to be verifiable.</p>
<pre><code class="language-pikchr indent toggle source-inline">B:  dot invis at (0,0)
Title: box invis &quot;LumoSQL Compared With Typical SQL Access Control&quot; ljust color purple at B+(1cm,0.4cm)

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at B+(0.6cm,-0.3cm)
box invis &quot;Object types: Yes, but only database, table and row&quot; ljust fit

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at 0.5cm below last circle
box invis &quot;At-rest encryption for all object types: Yes.&quot; ljust fit

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at 0.5cm below last circle
box invis &quot;Simple defaults: Yes. For a new database, a user has all privileges by default, which can be selectively tightened&quot; ljust fit

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at 0.5cm below last circle
box invis &quot;RBAC: Yes. Read/Write access for each object, enforced by the object being encrypted&quot; ljust fit

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at 0.5cm below last circle
box invis &quot;Portability and compatibility: Yes. Encrypted LumoSQL rows can be imported into other databases and verified there, or even decrypted if they have the key&quot; ljust fit

circle invis color green rad 0.4cm &quot;✔&quot; big big big bold at 0.5cm below last circle
box invis &quot;Distributed and Decentralised Key Management: Yes. Users can choose to use the optional blockchain-based LumoSQL key management system&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Table Policies: No.&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Column security and encryption: No.&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Complex role definitions: No. A user is either a superuser or not, or in a group or not, and a group has read or write access, or not. That's it.&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Inherit privileges: No.&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Predefined key management: No. Users can implement any key management system they choose, in the usual SQLite philosophy&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Network security: No. LumoSQL is an embedded database and needs no network security code.&quot; ljust fit

circle invis color red rad 0.4cm &quot;✘&quot; big big big bold at 0.5cm below last circle
box invis &quot;Transport security: No. Any plain-text transport may be used to move LumoSQL data that is encrypted at rest.&quot; ljust fit


</code></pre>
<h1 id="lumosql-encrypts-three-kinds-of-objects"><a class="header" href="#lumosql-encrypts-three-kinds-of-objects">LumoSQL Encrypts Three Kinds of Objects</a></h1>
<p>This diagram illustrates the way that any or all of the three layers of at-rest
encryption can be active at once, and their different scopes. </p>
<pre><code class="language-pikchr indent toggle source-inline">      fill = bisque
      linerad = 15px
      leftmargin = 2cm

      define diamond { \
        box wid 150% invis
        line from last.w to last.n to last.e to last.s close rad 0 $1
      }

      oval &quot;SUBMIT TICKET&quot; width 150%
      down
      arrow 50%
NEW:  file &quot;New bug ticket&quot; &quot;marked \&quot;Open\&quot;&quot; fit
      arrow same
      box &quot;Triage,&quot; &quot;augment &amp;&quot; &quot;correct&quot; fit
      arrow same
DC:   box &quot;Developer comments&quot; fit
      arrow same
FR:   box &quot;Filer responds&quot; fit
      arrow 100%
REJ:  diamond(&quot;Reject?&quot;)
      right
      arrow 100% &quot;Yes&quot; above
      box &quot;Mark ticket&quot; &quot;\&quot;Rejected\&quot; &amp;&quot; &quot;\&quot;Resolved\&quot;&quot; fit with .w at previous.e
      arrow right 50%
REJF: file &quot;Rejected&quot; &quot;ticket&quot; fit
      arrow right 50%
REOP: diamond(&quot;Reopen?&quot;)
      down
REJA: arrow 75% from REJ.s &quot;  No; fix it&quot; ljust
CHNG: box &quot;Developer changes code&quot; with .n at last arrow.s fit
      arrow 50%
FIXD: diamond(&quot;Fixed?&quot;)
      right
FNO:  arrow &quot;No&quot; above
RES:  box &quot;Optional:&quot; &quot;Update ticket resolution:&quot; &quot;\&quot;Partial Fix\&quot;, etc.&quot; fit
      down
      arrow 75% &quot;  Yes&quot; ljust from FIXD.s
      box &quot;Mark ticket&quot; &quot;\&quot;Fixed\&quot; &amp; \&quot;Closed\&quot;&quot; fit
      arrow 50%
RESF: file &quot;Resolved ticket&quot; fit
      arrow same
END:  oval &quot;END&quot;

      line from 0.3&lt;FR.ne,FR.se&gt; right even with 0.25 right of DC.e then up even with DC.e then to DC.e -&gt;

      line from NEW.w left 0.5 then down even with REJ.w then to REJ.w -&gt;

      line from RES.e right 0.3 then up even with CHNG.e then to CHNG.e -&gt;

      line from REOP.s &quot;No&quot; aligned above down 0.4
      line from previous.s down to (previous.s, RESF.e) then to RESF.e -&gt;

      line from REOP.n &quot;Yes&quot; aligned below up 0.3
      line from previous.n up even with 0.6&lt;FR.ne,FR.se&gt; then to 0.6&lt;FR.ne,FR.se&gt; -&gt;


</code></pre>
<h1 id="lumosql-rbac-permissions-system"><a class="header" href="#lumosql-rbac-permissions-system">LumoSQL RBAC Permissions System</a></h1>
<p><a href="https://en.wikipedia.org/wiki/Role-based_access_control">Role-based Access
Control</a> (RBAC) is the
way that online relational databases make sure that only authorised users can
access information. The SQL standard has the concept of &quot;roles&quot;, rather like
job titles. As a simple example, someone with &quot;engineering cadet&quot; role will see
different things in the database to someone with the &quot;sales manager&quot; role. RBAC
gets complicated, because people in organisations will often be in several
different roles, and roles can have different levels of privilege. Privileges
are things like &quot;read-only access&quot; and &quot;full read/write and edit&quot; access, and
&quot;allowed to create new roles&quot;.</p>
<p>A full RBAC implementation covering the many dozens of combinations of RBAC
possibilities is far outside the LumoSQL goals described above.</p>
<h2 id="existing-sqlite-permission-schemes"><a class="header" href="#existing-sqlite-permission-schemes">Existing SQLite Permission Schemes</a></h2>
<p>SQLite has a <a href="https://www.sqlite.org/src/doc/trunk/ext/userauth/user-auth.txt">user authentication extension</a>
which provides some basic access control, and seems to be quite rarely used. If
you have a valid username and a password, then the SQLite API will allow a
database connection. All users are equivalent, except that an admin user can
modify the contents of the new system table sqlite_user . All access is by
means of the C API. Anyone with the SQLite database file can open it and make
changes regardless of user authentication, because there is no encryption.
Various proprietary products such as
<a href="https://www.sqlite.org/see/doc/release/www/index.wiki">SEE</a> or
<a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a> can encrypt the entire SQLite
database, which works to some extent with SQLite user authentication.</p>
<h1 id="lumosql-rbac-goals-and-constraints"><a class="header" href="#lumosql-rbac-goals-and-constraints">LumoSQL RBAC Goals and Constraints</a></h1>
<p>LumoSQL RBAC aims to provide:</p>
<ul>
<li>
<p>Compatibility with existing SQLite binaries, when using the SQLite native db
format. If this means losing some more advanced features, that is acceptable
although regrettable. There is a big difference between the statements &quot;using
the native SQLite db format&quot;, and &quot;using the native SQLite BTree backend&quot;.  In
the latter case there is no more consrtaint with BTree than with LMDB or
anything else. In the former case, nothing can be stored in the binary image
that standard SQLite is not expecting, and this is a constraint.</p>
</li>
<li>
<p>Access control from SQL statements, with a similar user interface to the
major online databases, as described in this document</p>
</li>
<li>
<p>Fine-grained access control user interface per table, also with a similar
user interface to the major online databases</p>
</li>
<li>
<p>Ultra fine-grained per-row runtime access control</p>
</li>
<li>
<p>Ultra fine-grained at-rest access control, unique in the world of relational databases</p>
</li>
<li>
<p>Access control from SQLite pragmas, dot commands and commandline, however this will probably
always be a subset of the user interface exposed via SQL</p>
</li>
</ul>
<p>This point above of &quot;Ultra fine-grained at-rest access control&quot; means that,
even if someone has a LumoSQL database in their possession, they will only be
able to acces the specific rows in the specific tables to which they have a
valid username and password, or other such cryptographic key. This is really
unprecedented in relational databases.</p>
<p>The high-level design of the permissions system is taken from Postgres version 14:</p>
<ul>
<li>LumoSQL will implement a small but strict subset of Postgres permissions</li>
<li>LumoSQL will extend the Postgres design only in that it can apply per-row</li>
<li>These comments relate only to the design as exposed in SQL statements</li>
</ul>
<p>LumoSQL RBAC will be built in to the main code. It cannot be an extension
because of the fine-grained nature of the design. RBAC builds on the existing
per-row checksum code in LumoSQL.</p>
<p>LumoSQL RBAC does not require support from the storage subsystem, ie whether
the native BTree or LMDB or some other key-value storage system, RBAC will
still work because we are storing rows as opaque encrypted blocks.</p>
<p>The above must necessarily be implemented in a different way to any existing
database,  even though the SQL user interface is similar to others and entirely
derived from Postgres. The unique functionality of at-rest security and RBAC
means that the data must be stored as opaque rows, and while there will always
be RBAC-specific metadata stored in LumoSQL tables, it is possible and expected
that a single row's encrypted data can be exported and sent elsewhere, and the
RBAC remains functional to anyone with the correct key.</p>
<p>An example of how implementation must be different is that LumoSQL cannot have
an equivalent to the Postgres BYPASSRLS role attribute to bypass Row Level
Security, because for most operations nobody can bypass LumoSQL per-row RBAC.
If you don't have the key, a row is a block of bits with a little metadata.</p>
<p>Another example is that, conversely, everyone who can read a LumoSQL database
has permissions to dump all rows or at least all tables, because being an
embedded library it is guaranteed we can access the file. However the encrypted
tables or rows will never be plain text without the key, even for a dump
operation.</p>
<h1 id="interfaces-to-lumosql-security-system"><a class="header" href="#interfaces-to-lumosql-security-system">Interfaces to LumoSQL Security System</a></h1>
<p>The primary means of interacting with the security system is via the SQL commands.</p>
<p>For interacting with database objects (that is, whole database encryption) the
SQLite <a href="https://www.sqlite.org/see/doc/trunk/www/readme.wiki">Security Encryption Extension C API</a> is used, with some
of the key/rekey details modified for LumoSQL's different range of ciphers.</p>
<h2 id="enabling-and-disabling-row-level-permissions"><a class="header" href="#enabling-and-disabling-row-level-permissions">Enabling and Disabling Row-level Permissions</a></h2>
<p>Per-row access control is enabled by changing the definition as per the
<a href="https://www.postgresql.org/docs/14/sql-altertable.html">Postgres ALTER TABLE command</a>. ALTER TABLE
ENABLE/DISABLE refer to whether or not it is possible to use per-row security
in this table, not whether or not the feature is actually used. This matters when, for example,
we want to quickly determine if any rows <em>might</em> be protected in a database. If none of the tables 
have row level security enabled then there should not be any encrypted rows.</p>
<p>Example: ALTER TABLE foobar ENABLE ROW LEVEL SECURITY;</p>
<p>The way <a href="https://www.sqlite.org/schematab.html">SQLite implements the schema</a>
is helpful for implemnting per-row security. It differs from other databases
due to the nature of many embedded use cases. See the heading 
<a href="https://www.sqlite.org/lang_altertable.html">&quot;Why ALTER TABLE is such a problem for SQLite&quot;</a>,
which explains why SQLite stores the schema as the literal plain text CREATE
TABLE statements. This gives LumoSQL a lot more freedom to improve the
internals of row-based security without impacting on backwards compatibility
with other versions of LumoSQL.</p>
<h2 id="roles"><a class="header" href="#roles">Roles</a></h2>
<p>Adapted from <a href="https://www.postgresql.org/docs/14/user-manag.html">roles in Postgres 14</a>.</p>
<p>Roles take the place of users and groups. They can be called anything.</p>
<p>Roles have attributes. LumoSQL has only two attributes: LOGIN and
SUPERUSER (see https://www.postgresql.org/docs/13/role-attributes.html )
A superuser has complete access. A login user has default access,
and can have access added to or subtracted from the default access level.</p>
<p>Roles are managed with CREATE/DROP/ALTER ROLE statements, except
for defining access privileges in a detailed way.</p>
<p>Example: &quot;CREATE ROLE admins SUPERUSER&quot;</p>
<h2 id="privileges"><a class="header" href="#privileges">Privileges</a></h2>
<p>Adapted from <a href="https://www.postgresql.org/docs/14/ddl-priv.html">privileges in Postgres 14</a>.</p>
<p>LumoSQL privileges are hard-coded and cannot be extended.</p>
<p>Some privileges are assigned to roles and objects by default.</p>
<p>The complete list of LumoSQL privileges is:</p>
<ul>
<li>SELECT</li>
<li>UPDATE</li>
<li>INSERT</li>
<li>DELETE</li>
<li>CREATE</li>
</ul>
<p>The UPDATE and DELETE privileges imply SELECT. CREATE only applies to tables.
The keyword &quot;ALL&quot; is also allowed.</p>
<p>Note: In LumoSQL, SUPERUSER privileges cover much more than ALL, and these
additional privileges superuser has cannot be assigned in any way.</p>
<p>Default privileges of ALL are assigned to all roles for 
schema objects other than DATABASE and TABLE (and therefore 
for rows within each table.) This may need to be changed in
future versions of the LumoSQL per-row RBAC.</p>
<h2 id="granting-membership-to-a-role"><a class="header" href="#granting-membership-to-a-role">Granting membership to a Role</a></h2>
<p>This is one of two very different uses of and meanings for the GRANT statement, and is
adapted from <a href="https://www.postgresql.org/docs/14/sql-grant.html">GRANT in Postgres 14</a>. 
This usage is specific to roles, which typically means users such as an identifiable human or program.</p>
<p>The GRANT command grants membership in a role to one or more other
roles. Membership in a role is significant because it conveys the
privileges granted to a role to each of its members.</p>
<p>Only SUPERUSER can grant membership in roles.</p>
<p>Example: GRANT admins TO svetlana;</p>
<p>This means role svetlana is now a member of the role admins.</p>
<p>REVOKE undoes GRANT.</p>
<h2 id="granting-permissions-to-an-object"><a class="header" href="#granting-permissions-to-an-object">Granting permissions to an Object</a></h2>
<p>This is the second use for the GRANT statement, specific to database objects.</p>
<p>There are three objects that can be assigned permissions:</p>
<ul>
<li>DATABASE</li>
<li>TABLE</li>
<li>TABLE.ROW</li>
</ul>
<p>Nothing else in a schema can have its permissions assigned or changed. All
other objects are accessible with ALL privileges at all times, no matter who
the user is, or no identified user at all. This is the nature of an embedded system,
where we expect the user who can open a database will always have permissions to </p>
<p>Examples: GRANT INSERT ON some_table TO nikita;
GRANT ALL ON some_table TO nikita WHERE ROWID=54321;</p>
<p>REVOKE undoes GRANT. REVOKing table permissions does not revoke
row permissions, or vice versa.</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved Questions</a></h2>
<ul>
<li>What does it mean when a binary encrypted row is dumped? From the <a href="https://sqlite.org/cli.html">SQLite documentation</a>:</li>
</ul>
<p>: Use the &quot;.dump&quot; command to convert the entire contents of a database into a single UTF-8 text file. </p>
<p>We cannot turn an encrypted row into UTF-8 text without the key, and we cannot control who uses the dump command.</p>
<p>For example a dump session might look like:</p>
<pre><code>
$ lumosql rbac-example-db.lumo
@lumosql&gt; .dump
    :
INSERT INTO &quot;my_table&quot; VALUES(X'AB12340CDE.... 12234DEF');

</code></pre>
<ul>
<li>Related to the above, but to be very clear, an encrypted row is not another datatype, and the BLOB affinity cannot help here.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="statistical_analysis.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="encryption.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="statistical_analysis.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="encryption.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
